{% extends "base.html" %}

{% block title %}{{ driver.name }} - Detalhes do Motorista{% endblock %}

{% block content %}
<div style="padding: 2rem 0;">
    <!-- CabeÃ§alho -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <div>
            <h1>ğŸš— Detalhes do Motorista</h1>
            <p style="color: var(--gray-color); margin: 0.5rem 0;">VisualizaÃ§Ã£o completa dos dados e histÃ³rico</p>
        </div>
        <div style="display: flex; gap: 1rem;">
            <a href="/drivers/{{ driver.id }}/edit" class="btn btn-primary">âœï¸ Editar</a>
            <a href="/drivers" class="btn btn-secondary">ğŸ”™ Voltar</a>
        </div>
    </div>

    <!-- Status do Motorista -->
    <div class="card" style="margin-bottom: 2rem;">
        <div class="card-body" style="text-align: center;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ‘¨â€ğŸ’¼</div>
            <h2 style="color: var(--primary-color); margin-bottom: 0.5rem;">{{ driver.name }}</h2>
            <div style="display: flex; justify-content: center; gap: 2rem; margin-top: 1rem;">
                {% if driver.is_active %}
                    <span class="priority-normal" style="padding: 0.5rem 1rem; border-radius: 20px;">âœ… Motorista Ativo</span>
                {% else %}
                    <span class="priority-high" style="padding: 0.5rem 1rem; border-radius: 20px;">âŒ Motorista Inativo</span>
                {% endif %}
                <span class="priority-normal" style="padding: 0.5rem 1rem; border-radius: 20px;">ğŸªª CNH {{ driver.cnh_category }}</span>
            </div>
        </div>
    </div>

    <!-- EstatÃ­sticas -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
        <div class="stat-card">
            <div class="stat-number">{{ total_transports }}</div>
            <div class="stat-label">Total de Transportes</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-number">{{ completed_transports }}</div>
            <div class="stat-label">Transportes ConcluÃ­dos</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-number">
                {% if total_transports > 0 %}
                    {{ ((completed_transports / total_transports) * 100)|round|int }}%
                {% else %}
                    0%
                {% endif %}
            </div>
            <div class="stat-label">Taxa de ConclusÃ£o</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-number">
                {% set years_working = (driver.hire_date|length > 0) %}
                {% if years_working %}
                    {{ ((2025 - driver.hire_date[:4]|int)) if driver.hire_date[:4]|int < 2025 else 0 }}
                {% else %}
                    0
                {% endif %}
            </div>
            <div class="stat-label">Anos de ServiÃ§o</div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
        <!-- Dados Pessoais -->
        <div class="card">
            <div class="card-header">
                <h3>ğŸ‘¤ Dados Pessoais</h3>
            </div>
            <div class="card-body">
                <div style="display: grid; gap: 1rem;">
                    <div>
                        <label style="font-weight: bold; color: var(--text-color);">Nome Completo:</label>
                        <p style="margin: 0.25rem 0; padding: 0.5rem; background-color: var(--color-95); border-radius: 5px;">{{ driver.name }}</p>
                    </div>
                    
                    <div>
                        <label style="font-weight: bold; color: var(--text-color);">CPF:</label>
                        <p style="margin: 0.25rem 0; padding: 0.5rem; background-color: var(--color-95); border-radius: 5px;">{{ driver.cpf }}</p>
                    </div>
                    
                    <div>
                        <label style="font-weight: bold; color: var(--text-color);">Telefone:</label>
                        <p style="margin: 0.25rem 0; padding: 0.5rem; background-color: var(--color-95); border-radius: 5px;">{{ driver.phone or 'NÃ£o informado' }}</p>
                    </div>
                    
                    <div>
                        <label style="font-weight: bold; color: var(--text-color);">EndereÃ§o:</label>
                        <p style="margin: 0.25rem 0; padding: 0.5rem; background-color: var(--color-95); border-radius: 5px;">{{ driver.address or 'NÃ£o informado' }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dados Profissionais -->
        <div class="card">
            <div class="card-header">
                <h3>ğŸªª Dados da CNH e ContrataÃ§Ã£o</h3>
            </div>
            <div class="card-body">
                <div style="display: grid; gap: 1rem;">
                    <div>
                        <label style="font-weight: bold; color: var(--text-color);">NÃºmero da CNH:</label>
                        <p style="margin: 0.25rem 0; padding: 0.5rem; background-color: var(--color-95); border-radius: 5px;">{{ driver.cnh }}</p>
                    </div>
                    
                    <div>
                        <label style="font-weight: bold; color: var(--text-color);">Categoria:</label>
                        <p style="margin: 0.25rem 0; padding: 0.5rem; background-color: var(--color-95); border-radius: 5px;">
                            <span class="priority-normal" style="font-weight: bold;">{{ driver.cnh_category }}</span>
                            {% if driver.cnh_category == 'D' %}
                                - Habilitado para transporte de passageiros
                            {% elif driver.cnh_category == 'C' %}
                                - Habilitado para veÃ­culos de carga
                            {% elif driver.cnh_category == 'B' %}
                                - VeÃ­culos de passeio
                            {% endif %}
                        </p>
                    </div>
                    
                    <div>
                        <label style="font-weight: bold; color: var(--text-color);">Validade da CNH:</label>
                        <p style="margin: 0.25rem 0; padding: 0.5rem; background-color: var(--color-95); border-radius: 5px;">
                            {{ driver.cnh_expiry }}
                            {% if driver.cnh_expiry %}
                                <!-- Aqui poderia calcular dias para vencer -->
                                <small style="color: var(--success-color);">âœ… VÃ¡lida</small>
                            {% endif %}
                        </p>
                    </div>
                    
                    <div>
                        <label style="font-weight: bold; color: var(--text-color);">Data de ContrataÃ§Ã£o:</label>
                        <p style="margin: 0.25rem 0; padding: 0.5rem; background-color: var(--color-95); border-radius: 5px;">{{ driver.hire_date }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- HistÃ³rico de Transportes -->
    <div class="card" style="margin-top: 2rem;">
        <div class="card-header">
            <h3>ğŸ“‹ Ãšltimos Transportes Realizados</h3>
        </div>
        <div class="card-body">
            {% if recent_transports %}
                <div style="overflow-x: auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Paciente</th>
                                <th>Destino</th>
                                <th>VeÃ­culo</th>
                                <th>Status</th>
                                <th>ObservaÃ§Ãµes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for transport in recent_transports %}
                            <tr>
                                <td>{{ transport.appointment_date }}</td>
                                <td>{{ transport.patient_name or 'N/A' }}</td>
                                <td>{{ transport.destination }}</td>
                                <td>{{ transport.vehicle_plate or 'N/A' }}</td>
                                <td>
                                    {% if transport.status == 'agendado' %}
                                        <span class="priority-normal">Agendado</span>
                                    {% elif transport.status == 'em_andamento' %}
                                        <span class="priority-medium">Em Andamento</span>
                                    {% elif transport.status == 'concluido' %}
                                        <span class="priority-normal">ConcluÃ­do</span>
                                    {% else %}
                                        <span class="priority-high">Cancelado</span>
                                    {% endif %}
                                </td>
                                <td>{{ transport.observations[:50] + '...' if transport.observations and transport.observations|length > 50 else transport.observations or '-' }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                {% if total_transports > 10 %}
                <div style="text-align: center; margin-top: 1rem;">
                    <p style="color: var(--gray-color);">Mostrando os 10 transportes mais recentes de {{ total_transports }} no total.</p>
                    <a href="/transports?driver={{ driver.id }}" class="btn btn-secondary">Ver Todo o HistÃ³rico</a>
                </div>
                {% endif %}
            {% else %}
                <div style="text-align: center; padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“‹</div>
                    <h4>Nenhum transporte realizado</h4>
                    <p style="color: var(--gray-color);">Este motorista ainda nÃ£o realizou nenhum transporte.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- AÃ§Ãµes -->
    <div style="display: flex; gap: 1rem; margin-top: 2rem; justify-content: center;">
        <a href="/drivers/{{ driver.id }}/edit" class="btn btn-primary">âœï¸ Editar Dados</a>
        <a href="/transports/new?driver={{ driver.id }}" class="btn btn-secondary">ğŸ“… Agendar Transporte</a>
        <a href="/drivers" class="btn" style="background-color: var(--gray-color); color: white;">ğŸ”™ Voltar Ã  Lista</a>
    </div>
</div>
{% endblock %}