{% extends "base.html" %}

{% block title %}{% if patient %}Editar{% else %}Novo{% endif %} Paciente{% endblock %}

{% block content %}
<div style="padding: 2rem 0;">
    <h1> {% if patient %}Editar{% else %}Novo{% endif %} Paciente</h1>
    
    <div class="card">
        <div class="card-header">
            <h3>{% if patient %}Editar Dados do{% else %}Cadastrar Novo{% endif %} Paciente</h3>
        </div>
        <div class="card-body">
            <form method="POST">
                <!-- DADOS B√ÅSICOS DO PACIENTE -->
                <div style="background-color: var(--color-95); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">üìã Dados B√°sicos do Paciente</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label" for="cpf">CPF: *</label>
                            <input type="text" id="cpf" name="cpf" class="form-input" 
                                   value="{{ patient.cpf if patient else '' }}" 
                                   placeholder="000.000.000-00" maxlength="14" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="name">Nome Completo: *</label>
                            <input type="text" id="name" name="name" class="form-input" 
                                   value="{{ patient.name if patient else '' }}" 
                                   placeholder="Nome completo do paciente" required style="text-transform: uppercase;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label" for="birth_date">Data de Nascimento: *</label>
                            <input type="date" id="birth_date" name="birth_date" class="form-input" 
                                   value="{{ patient.birth_date if patient else '' }}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="phone">Telefone:</label>
                            <input type="text" id="phone" name="phone" class="form-input" 
                                   value="{{ patient.phone if patient else '' }}" 
                                   placeholder="(00) 00000-0000">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="address">Endere√ßo:</label>
                        <textarea id="address" name="address" class="form-textarea" rows="2" 
                                  placeholder="Endere√ßo completo">{{ patient.address if patient else '' }}</textarea>
                    </div>
                </div>

                <!-- DADOS DO AGENDAMENTO -->
                <div style="background-color: var(--color-95); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;"> Dados do Agendamento</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label" for="appointment_date">Data do Agendamento: *</label>
                            <input type="date" id="appointment_date" name="appointment_date" class="form-input" 
                                   value="{{ patient.appointment_date if patient else '' }}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="attendant_name">Nome do Atendente: *</label>
                            <input type="text" id="attendant_name" name="attendant_name" class="form-input" 
                                   value="{{ patient.attendant_name if patient else '' }}" 
                                   placeholder="Nome do atendente" required style="text-transform: uppercase;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label" for="destination">Destino: *</label>
                            <select id="destination" name="destination" class="form-select" required>
                                <option value="">Selecione o destino...</option>
                                <option value="Hospital Regional de Sobradinho" {{ 'selected' if patient and patient.destination == 'Hospital Regional de Sobradinho' else '' }}>Hospital Regional de Sobradinho</option>
                                <option value="Hospital de Base do DF" {{ 'selected' if patient and patient.destination == 'Hospital de Base do DF' else '' }}>Hospital de Base do DF</option>
                                <option value="Hospital da Crian√ßa de Bras√≠lia" {{ 'selected' if patient and patient.destination == 'Hospital da Crian√ßa de Bras√≠lia' else '' }}>Hospital da Crian√ßa de Bras√≠lia</option>
                                <option value="Instituto de Cardiologia do DF" {{ 'selected' if patient and patient.destination == 'Instituto de Cardiologia do DF' else '' }}>Instituto de Cardiologia do DF</option>
                                <option value="Hospital Materno Infantil de Bras√≠lia" {{ 'selected' if patient and patient.destination == 'Hospital Materno Infantil de Bras√≠lia' else '' }}>Hospital Materno Infantil de Bras√≠lia</option>
                                <option value="Centro de Reabilita√ß√£o SARAH" {{ 'selected' if patient and patient.destination == 'Centro de Reabilita√ß√£o SARAH' else '' }}>Centro de Reabilita√ß√£o SARAH</option>
                                <option value="Hospital Universit√°rio de Bras√≠lia" {{ 'selected' if patient and patient.destination == 'Hospital Universit√°rio de Bras√≠lia' else '' }}>Hospital Universit√°rio de Bras√≠lia</option>
                                <option value="Instituto de Oncologia do DF" {{ 'selected' if patient and patient.destination == 'Instituto de Oncologia do DF' else '' }}>Instituto de Oncologia do DF</option>
                                <option value="Centro de Hemodi√°lise de Bras√≠lia" {{ 'selected' if patient and patient.destination == 'Centro de Hemodi√°lise de Bras√≠lia' else '' }}>Centro de Hemodi√°lise de Bras√≠lia</option>
                                <option value="Cl√≠nica de Radioterapia" {{ 'selected' if patient and patient.destination == 'Cl√≠nica de Radioterapia' else '' }}>Cl√≠nica de Radioterapia</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="appointment_time">Hor√°rio da Consulta:</label>
                            <input type="time" id="appointment_time" name="appointment_time" class="form-input" 
                                   value="{{ patient.appointment_time if patient else '' }}">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="specialty">Especialidade/Exame: *</label>
                        <select id="specialty" name="specialty" class="form-select" required onchange="toggleOtherSpecialty()">
                            <option value="">Selecione a especialidade...</option>
                            
                            <optgroup label=" Cl√≠nica Geral">
                                <option value="Consulta Cl√≠nica Geral" {{ 'selected' if patient and patient.specialty == 'Consulta Cl√≠nica Geral' else '' }}>Consulta Cl√≠nica Geral</option>
                                <option value="Hemograma completo" {{ 'selected' if patient and patient.specialty == 'Hemograma completo' else '' }}>Hemograma completo</option>
                                <option value="Glicemia em jejum" {{ 'selected' if patient and patient.specialty == 'Glicemia em jejum' else '' }}>Glicemia em jejum</option>
                                <option value="Colesterol total e fra√ß√µes" {{ 'selected' if patient and patient.specialty == 'Colesterol total e fra√ß√µes' else '' }}>Colesterol total e fra√ß√µes</option>
                                <option value="Urina tipo I" {{ 'selected' if patient and patient.specialty == 'Urina tipo I' else '' }}>Urina tipo I</option>
                            </optgroup>
                            
                            <optgroup label=" Cardiologia">
                                <option value="Consulta Cardiologia" {{ 'selected' if patient and patient.specialty == 'Consulta Cardiologia' else '' }}>Consulta Cardiologia</option>
                                <option value="Eletrocardiograma (ECG)" {{ 'selected' if patient and patient.specialty == 'Eletrocardiograma (ECG)' else '' }}>Eletrocardiograma (ECG)</option>
                                <option value="Ecocardiograma" {{ 'selected' if patient and patient.specialty == 'Ecocardiograma' else '' }}>Ecocardiograma</option>
                                <option value="Teste ergom√©trico" {{ 'selected' if patient and patient.specialty == 'Teste ergom√©trico' else '' }}>Teste ergom√©trico</option>
                                <option value="Holter 24h" {{ 'selected' if patient and patient.specialty == 'Holter 24h' else '' }}>Holter 24h</option>
                                <option value="MAPA" {{ 'selected' if patient and patient.specialty == 'MAPA' else '' }}>MAPA</option>
                            </optgroup>
                            
                            <optgroup label=" Pneumologia">
                                <option value="Consulta Pneumologia" {{ 'selected' if patient and patient.specialty == 'Consulta Pneumologia' else '' }}>Consulta Pneumologia</option>
                                <option value="Espirometria" {{ 'selected' if patient and patient.specialty == 'Espirometria' else '' }}>Espirometria</option>
                                <option value="Radiografia de t√≥rax" {{ 'selected' if patient and patient.specialty == 'Radiografia de t√≥rax' else '' }}>Radiografia de t√≥rax</option>
                                <option value="Tomografia de t√≥rax" {{ 'selected' if patient and patient.specialty == 'Tomografia de t√≥rax' else '' }}>Tomografia de t√≥rax</option>
                            </optgroup>
                            
                            <optgroup label="üçΩÔ∏è Gastroenterologia">
                                <option value="Consulta Gastroenterologia" {{ 'selected' if patient and patient.specialty == 'Consulta Gastroenterologia' else '' }}>Consulta Gastroenterologia</option>
                                <option value="Endoscopia digestiva alta" {{ 'selected' if patient and patient.specialty == 'Endoscopia digestiva alta' else '' }}>Endoscopia digestiva alta</option>
                                <option value="Colonoscopia" {{ 'selected' if patient and patient.specialty == 'Colonoscopia' else '' }}>Colonoscopia</option>
                                <option value="Ultrassom abdominal" {{ 'selected' if patient and patient.specialty == 'Ultrassom abdominal' else '' }}>Ultrassom abdominal</option>
                            </optgroup>
                            
                            <optgroup label="üß† Neurologia">
                                <option value="Consulta Neurologia" {{ 'selected' if patient and patient.specialty == 'Consulta Neurologia' else '' }}>Consulta Neurologia</option>
                                <option value="Eletroencefalograma (EEG)" {{ 'selected' if patient and patient.specialty == 'Eletroencefalograma (EEG)' else '' }}>Eletroencefalograma (EEG)</option>
                                <option value="Resson√¢ncia magn√©tica de enc√©falo" {{ 'selected' if patient and patient.specialty == 'Resson√¢ncia magn√©tica de enc√©falo' else '' }}>Resson√¢ncia magn√©tica de enc√©falo</option>
                                <option value="Tomografia de cr√¢nio" {{ 'selected' if patient and patient.specialty == 'Tomografia de cr√¢nio' else '' }}>Tomografia de cr√¢nio</option>
                            </optgroup>
                            
                            <optgroup label="ü¶¥ Ortopedia">
                                <option value="Consulta Ortopedia" {{ 'selected' if patient and patient.specialty == 'Consulta Ortopedia' else '' }}>Consulta Ortopedia</option>
                                <option value="Radiografia √≥ssea" {{ 'selected' if patient and patient.specialty == 'Radiografia √≥ssea' else '' }}>Radiografia √≥ssea</option>
                                <option value="Resson√¢ncia magn√©tica articular" {{ 'selected' if patient and patient.specialty == 'Resson√¢ncia magn√©tica articular' else '' }}>Resson√¢ncia magn√©tica articular</option>
                                <option value="Densitometria √≥ssea" {{ 'selected' if patient and patient.specialty == 'Densitometria √≥ssea' else '' }}>Densitometria √≥ssea</option>
                            </optgroup>
                            
                            <optgroup label="ü©∏ Endocrinologia">
                                <option value="Consulta Endocrinologia" {{ 'selected' if patient and patient.specialty == 'Consulta Endocrinologia' else '' }}>Consulta Endocrinologia</option>
                                <option value="Dosagem hormonal" {{ 'selected' if patient and patient.specialty == 'Dosagem hormonal' else '' }}>Dosagem hormonal</option>
                                <option value="Hemoglobina glicada" {{ 'selected' if patient and patient.specialty == 'Hemoglobina glicada' else '' }}>Hemoglobina glicada</option>
                                <option value="Ultrassom de tireoide" {{ 'selected' if patient and patient.specialty == 'Ultrassom de tireoide' else '' }}>Ultrassom de tireoide</option>
                            </optgroup>
                            
                            <optgroup label="üë©‚Äç‚öïÔ∏è Ginecologia">
                                <option value="Consulta Ginecologia" {{ 'selected' if patient and patient.specialty == 'Consulta Ginecologia' else '' }}>Consulta Ginecologia</option>
                                <option value="Papanicolau" {{ 'selected' if patient and patient.specialty == 'Papanicolau' else '' }}>Papanicolau</option>
                                <option value="Ultrassom transvaginal" {{ 'selected' if patient and patient.specialty == 'Ultrassom transvaginal' else '' }}>Ultrassom transvaginal</option>
                                <option value="Ultrassom obst√©trico" {{ 'selected' if patient and patient.specialty == 'Ultrassom obst√©trico' else '' }}>Ultrassom obst√©trico</option>
                            </optgroup>
                            
                            <optgroup label="üî¨ Urologia">
                                <option value="Consulta Urologia" {{ 'selected' if patient and patient.specialty == 'Consulta Urologia' else '' }}>Consulta Urologia</option>
                                <option value="PSA" {{ 'selected' if patient and patient.specialty == 'PSA' else '' }}>PSA</option>
                                <option value="Ultrassom de pr√≥stata" {{ 'selected' if patient and patient.specialty == 'Ultrassom de pr√≥stata' else '' }}>Ultrassom de pr√≥stata</option>
                                <option value="Urocultura" {{ 'selected' if patient and patient.specialty == 'Urocultura' else '' }}>Urocultura</option>
                            </optgroup>
                            
                            <optgroup label="üëÅÔ∏è Oftalmologia">
                                <option value="Consulta Oftalmologia" {{ 'selected' if patient and patient.specialty == 'Consulta Oftalmologia' else '' }}>Consulta Oftalmologia</option>
                                <option value="Exame de vista" {{ 'selected' if patient and patient.specialty == 'Exame de vista' else '' }}>Exame de vista</option>
                                <option value="Tonometria" {{ 'selected' if patient and patient.specialty == 'Tonometria' else '' }}>Tonometria</option>
                            </optgroup>
                            
                            <optgroup label="üéØ Oncologia">
                                <option value="Consulta Oncologia" {{ 'selected' if patient and patient.specialty == 'Consulta Oncologia' else '' }}>Consulta Oncologia</option>
                                <option value="Quimioterapia" {{ 'selected' if patient and patient.specialty == 'Quimioterapia' else '' }}>Quimioterapia</option>
                                <option value="Radioterapia" {{ 'selected' if patient and patient.specialty == 'Radioterapia' else '' }}>Radioterapia</option>
                                <option value="PET-CT oncol√≥gico" {{ 'selected' if patient and patient.specialty == 'PET-CT oncol√≥gico' else '' }}>PET-CT oncol√≥gico</option>
                            </optgroup>
                            
                            <optgroup label="üíâ Hematologia">
                                <option value="Consulta Hematologia" {{ 'selected' if patient and patient.specialty == 'Consulta Hematologia' else '' }}>Consulta Hematologia</option>
                                <option value="Hemodi√°lise" {{ 'selected' if patient and patient.specialty == 'Hemodi√°lise' else '' }}>Hemodi√°lise</option>
                                <option value="Mielograma" {{ 'selected' if patient and patient.specialty == 'Mielograma' else '' }}>Mielograma</option>
                            </optgroup>
                            
                            <optgroup label="üî¨ Outros">
                                <option value="Pun√ß√£o lombar" {{ 'selected' if patient and patient.specialty == 'Pun√ß√£o lombar' else '' }}>Pun√ß√£o lombar</option>
                                <option value="Doppler transcraniano" {{ 'selected' if patient and patient.specialty == 'Doppler transcraniano' else '' }}>Doppler transcraniano</option>
                                <option value="Outro" {{ 'selected' if patient and patient.specialty == 'Outro' else '' }}>Outro (especificar abaixo)</option>
                            </optgroup>
                        </select>
                    </div>
                    
                    <div class="form-group" id="other_specialty_field" style="display: none;">
                        <label class="form-label" for="other_specialty">Especificar Outra Especialidade/Exame:</label>
                        <input type="text" id="other_specialty" name="other_specialty" class="form-input" 
                               value="{{ patient.other_specialty if patient else '' }}" 
                               placeholder="Digite a especialidade ou exame espec√≠fico">
                    </div>
                </div>

                <!-- DADOS DO ACOMPANHANTE -->
                <div style="background-color: var(--color-95); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">üë• Dados do Acompanhante</h4>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="has_companion" name="has_companion" value="1" 
                                   {{ 'checked' if patient and patient.has_companion else '' }}
                                   onchange="toggleCompanionFields()">
                            Paciente ter√° acompanhante
                        </label>
                    </div>
                    
                    <div id="companion_fields" style="display: none;">
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 1rem;">
                            <div class="form-group">
                                <label class="form-label" for="companion_count">N√∫mero de Acompanhantes:</label>
                                <select id="companion_count" name="companion_count" class="form-select">
                                    <option value="0">0</option>
                                    <option value="1" {{ 'selected' if patient and patient.companion_count == 1 else '' }}>1</option>
                                    <option value="2" {{ 'selected' if patient and patient.companion_count == 2 else '' }}>2</option>
                                    <option value="3" {{ 'selected' if patient and patient.companion_count == 3 else '' }}>3</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="companion_name">Nome do Acompanhante:</label>
                                <input type="text" id="companion_name" name="companion_name" class="form-input" 
                                       value="{{ patient.companion_name if patient else '' }}" 
                                       placeholder="Nome completo do acompanhante" style="text-transform: uppercase;">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="companion_rg">RG do Acompanhante:</label>
                            <input type="text" id="companion_rg" name="companion_rg" class="form-input" 
                                   value="{{ patient.companion_rg if patient else '' }}" 
                                   placeholder="00.000.000-0">
                        </div>
                    </div>
                </div>

                <!-- DADOS COMPLEMENTARES -->
                <div style="background-color: var(--color-95); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">üìù Dados Complementares</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label" for="emergency_contact">Contato de Emerg√™ncia:</label>
                            <input type="text" id="emergency_contact" name="emergency_contact" class="form-input" 
                                   value="{{ patient.emergency_contact if patient else '' }}" 
                                   placeholder="Nome do contato">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="emergency_phone">Telefone de Emerg√™ncia:</label>
                            <input type="text" id="emergency_phone" name="emergency_phone" class="form-input" 
                                   value="{{ patient.emergency_phone if patient else '' }}" 
                                   placeholder="(00) 00000-0000">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label" for="priority_type">Tipo de Prioridade:</label>
                            <select id="priority_type" name="priority_type" class="form-select">
                                <option value="normal" {{ 'selected' if patient and patient.priority_type == 'normal' else '' }}>Normal</option>
                                <option value="idoso" {{ 'selected' if patient and patient.priority_type == 'idoso' else '' }}>Idoso</option>
                                <option value="gestante" {{ 'selected' if patient and patient.priority_type == 'gestante' else '' }}>Gestante</option>
                                <option value="crianca_autista" {{ 'selected' if patient and patient.priority_type == 'crianca_autista' else '' }}>Crian√ßa Autista</option>
                                <option value="oncologia" {{ 'selected' if patient and patient.priority_type == 'oncologia' else '' }}>Oncologia</option>
                                <option value="bebe_prematuro" {{ 'selected' if patient and patient.priority_type == 'bebe_prematuro' else '' }}>Beb√™ Prematuro</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="special_needs">Necessidades Especiais:</label>
                            <select id="special_needs" name="special_needs" class="form-select">
                                <option value="">Nenhuma</option>
                                <option value="cadeira_rodas" {{ 'selected' if patient and patient.special_needs == 'cadeira_rodas' else '' }}>Cadeira de Rodas</option>
                                <option value="maca" {{ 'selected' if patient and patient.special_needs == 'maca' else '' }}>Maca</option>
                                <option value="oxigenio" {{ 'selected' if patient and patient.special_needs == 'oxigenio' else '' }}>Oxig√™nio</option>
                                <option value="monitor_cardiaco" {{ 'selected' if patient and patient.special_needs == 'monitor_cardiaco' else '' }}>Monitor Card√≠aco</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="submit" class="btn btn-primary">
                        üíæ {% if patient %}Atualizar{% else %}Cadastrar{% endif %} Paciente
                    </button>
                    <a href="/patients" class="btn btn-secondary">
                        ‚ùå Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Mostrar campo de especialidade personalizada
function toggleOtherSpecialty() {
    const specialty = document.getElementById('specialty');
    const otherField = document.getElementById('other_specialty_field');
    
    if (specialty.value === 'Outro') {
        otherField.style.display = 'block';
        document.getElementById('other_specialty').required = true;
    } else {
        otherField.style.display = 'none';
        document.getElementById('other_specialty').required = false;
    }
}

// Mostrar campos do acompanhante
function toggleCompanionFields() {
    const hasCompanion = document.getElementById('has_companion');
    const companionFields = document.getElementById('companion_fields');
    
    if (hasCompanion.checked) {
        companionFields.style.display = 'block';
    } else {
        companionFields.style.display = 'none';
    }
}

// Inicializar campos na carga da p√°gina
document.addEventListener('DOMContentLoaded', function() {
    toggleOtherSpecialty();
    toggleCompanionFields();
});
</script>
{% endblock %}